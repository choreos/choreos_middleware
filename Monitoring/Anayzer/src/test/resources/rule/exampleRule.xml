<?xml version="1.0" encoding="UTF-8"?>
<ComplexEventRuleActionList xmlns="http://labse.isti.cnr.it/glimpse/xml/ComplexEventRule"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://labse.isti.cnr.it/glimpse/xml/ComplexEventRule ./ComplexEventRule.xsd">
<Insert RuleType="drools">
	<RuleName>MessagesFromNS1Value</RuleName>
        <RuleBody>
        import it.cnr.isti.labse.glimpse.event.GlimpseBaseEventImpl;
        import it.cnr.isti.labse.glimpse.manager.ResponseDispatcher;
        import it.cnr.isti.labse.glimpse.utils.NotifierUtils;
        
        declare GlimpseBaseEventImpl
	        @role( event )
	        @timestamp( timestamp )
        end
        
		rule "MessagesFromNS1Value"
		no-loop
		salience 999
		dialect "java"
		when
			$aEvent : GlimpseBaseEventImpl(this.networkedSystemSource == "NS1", this.getConsumed == false, this.isException == false);
		then
			$aEvent.setConsumed(true);
			update( $aEvent );
			retract( $aEvent );
		ResponseDispatcher.NotifyMeValue(
				drools.getRule().getName(),
				"consumerTest",
				NotifierUtils.eventName($aEvent.getName()),
				NotifierUtils.eventName((String)$aEvent.getData()));
		end
        </RuleBody>
	</Insert>
	<Insert RuleType="drools">
	<RuleName>ExceptionsFromNS1</RuleName>
        <RuleBody>
        import it.cnr.isti.labse.glimpse.event.GlimpseBaseEventImpl;
        import it.cnr.isti.labse.glimpse.manager.ResponseDispatcher;
        import it.cnr.isti.labse.glimpse.utils.NotifierUtils;
        
        declare GlimpseBaseEventImpl
	        @role( event )
	        @timestamp( timestamp )
        end
        
		rule "ExceptionsFromNS1"
		no-loop
		salience 999
		dialect "java"
		when
			$aEvent : GlimpseBaseEventImpl(this.networkedSystemSource == "NS1", this.isException == true, this.getConsumed == false);
		then
			$aEvent.setConsumed(true);
			update( $aEvent );
			retract( $aEvent );
			ResponseDispatcher.NotifyMeException(drools.getRule().getName(),
				"consumerTest", (Exception)$aEvent.getData());
		end
        </RuleBody>
	</Insert>
</ComplexEventRuleActionList>