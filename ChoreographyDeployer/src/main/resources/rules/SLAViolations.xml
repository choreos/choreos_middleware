<?xml version="1.0" encoding="UTF-8"?>
<ComplexEventRuleActionList
	xmlns="http://labse.isti.cnr.it/glimpse/xml/ComplexEventRule"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://labse.isti.cnr.it/glimpse/xml/ComplexEventRule ./ComplexEventRule.xsd">
	<Insert RuleType="drools">
		<RuleName>cpu_user</RuleName>
		<RuleBody>
			import it.cnr.isti.labse.glimpse.event.GlimpseBaseEventChoreos;
			import it.cnr.isti.labse.glimpse.manager.ResponseDispatcher;
			import it.cnr.isti.labse.glimpse.utils.NotifierUtils;

			declare GlimpseBaseEventChoreos
				@role( event )
				@timestamp( timeStamp )
			end

			rule "cpu-user-limit"
			no-loop
			salience 999
			dialect "java"
			
			when
				$bEvent : GlimpseBaseEventChoreos(this.getEventName == "cpu_user", this.isConsumed == false);
			then
				ResponseDispatcher.NotifyMeValue(drools.getRule().getName(), "consumerTest", $bEvent.getEventName(), (String) $bEvent.getEventData());
				
				$bEvent.setConsumed(true);
				update( $bEvent );
			end
		</RuleBody>
	</Insert>
</ComplexEventRuleActionList>